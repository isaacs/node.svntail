{"name":"svntail","body":"演示截图\r\n===================\r\n![SVN尾巴](http://xunuo.com/node.svntail.snap1.png)\r\n\r\n***************\r\n\r\n安装手册\r\n====================\r\n\r\n依赖\r\n--------------------\r\nnodejs 0.6.1x  \r\n[NodeJS官方网站](http://nodejs.org/) | [安装参考文章](https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager)\r\n\r\n定位hooks目录\r\n--------------------\r\n一般hooks目录位于svn库根目录下，一般同级的目录还有dav、db、locks\r\n\r\n通过NPM安装node.svntail\r\n--------------------\r\n~~~javascript\r\n// 在hooks目录下运行\r\nnpm install node.svntail\r\n~~~\r\n\r\n[NPM包详情](http://search.npmjs.org/#/node.svntail)\r\n\r\n\r\n修改pre-commit文件(以下是示例)\r\n--------------------\r\n\r\n\r\n注意！在一切开始前，首先要给pre-commit赋可执行权限。\r\n\r\n\r\n~~~javascript\r\n#!/usr/bin/node\r\n\r\n/**\r\n * 配置集合\r\n*/\r\nvar config = {\r\n\t/**\r\n\t * 总控开关 (on/off)\r\n\t * @property config.switch {string}\r\n\t */\r\n\tswitch : \"on\",\r\n\t/** \r\n\t * 版本库地址\r\n\t * @property config.repos {string}\r\n\t */\r\n\trepos : process.argv[2],\r\n\t/** \r\n\t * 当前提交唯一标识戳 中间状态版本号\r\n\t * @property config.txn {string}\r\n\t */\r\n\ttxn : process.argv[3],\r\n\t/** \r\n\t * 作用域\r\n\t * @property config.scope {array}\r\n\t */\r\n\tscope : ['^intl-style/*'],\r\n\t/** \r\n\t * debug 模式 （额外信息输出）\r\n\t * @property config.debug {boolean}\r\n\t */\r\n\tdebug : false,\r\n\t/** \r\n\t * SVN提交内容缓存路径 检测作用域\r\n\t * @property config.tempPath {string}\r\n\t */\r\n\ttempPath : __dirname + '/temp-svntail-pre-commit/' + process.argv[3],\r\n\t/**\r\n\t * svnlook命令全路径\r\n\t * 通过whereis svnlook可获取，通常是 /usr/bin/svnlook 或 /usr/local/bin/svnlook\r\n\t * @property config.cmdSvnlook {string}\r\n\t */\r\n\tcmdSvnlook : 'LANG=zh_CN.utf8 /usr/local/bin/svnlook',\r\n\t/**\r\n\t * 是否需要传输数据到远程API\r\n\t * @property config.remoteConnect {boolean}\r\n\t */\r\n\tremoteConnect : false,\r\n\t/**\r\n\t * 远程API设置 ( 用于发送提交信息至此API )\r\n\t * @property config.remoteApiSettings {object}\r\n\t */\r\n\tremoteApiSettings : {\r\n    host: 'reporter.aliui.com',\r\n    port: '99',\r\n    path: '/api.js',\r\n    method: 'POST'\r\n  },\r\n\t/**\r\n\t * 强制提交注释标识\r\n\t * @property config.forceCommitLog {string}\r\n\t */\r\n\tforceCommitLog : '--force-commit',\r\n\t/**\r\n\t * 是否自动删除缓存文件\r\n\t * @property config.autoDelTemp {boolean}\r\n\t */\r\n\tautoDelTemp : true,\r\n\t/**\r\n\t * 各种检测模块配置  （和检测模块同名）\r\n\t * @property config.lintsConfig {object}\r\n\t */\r\n\tvalidateConfigs : {\r\n\t\t\r\n\t\t// 提交路径检测规则\r\n\t\t'mod-validator-path' : {\r\n\t\t\t// 新增目录规则\r\n\t\t\t'TheNewDirNameRules' : {\r\n\t\t\t\truleName : 'The New Dir Name Validate Rules',\r\n\t\t\t\t//warnning : '新增目录规则为 : 英文小写字母、数字、中划线连接(开头允许一个下划线)'\r\n\t\t\t\twarnning : '(!) Found Some Dir(s) Name Errors, Rule: lowcase letters, number & line-through[or begining_underline].',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'dir',\r\n\t\t\t\t\tcommitType : ['A']\r\n\t\t\t\t},\r\n\t\t\t\tvalidateRule : '^_?[a-z0-9-]*/$'\r\n\t\t\t},\r\n\t\t\t// 新增文件规则\r\n\t\t\t'TheNewFileNameRules' : {\r\n\t\t\t\truleName : 'The New File Name Validate Rules',\r\n\t\t\t\t//warnning : '新增文件规则为 : 英文小写字母、数字、中划线连接。'\r\n\t\t\t\twarnning : '(!) Found Some File(s) Name Errors, Rule: lowcase letters, number & line-through.',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'file',\r\n\t\t\t\t\tcommitType : ['A']\r\n\t\t\t\t},\r\n\t\t\t\tvalidateRule : '^[a-z0-9-./]*$'\r\n\t\t\t},\r\n\t\t\t// JS目录文件规则\r\n\t\t\t'JsDirRules' : {\r\n\t\t\t\truleName : 'The Js Dir Validate Rules',\r\n\t\t\t\twarnning : '(!) New js file rule is : extname must be [js|md|js.seed|xml|html|spec.js].',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'file',\r\n\t\t\t\t\tcommitType : ['A'],\r\n\t\t\t\t\tinRegx : ['^intl-style/trunk/deploy/htdocs/js/*','^intl-style/branches/.*?/deploy/htdocs/js/*'],\r\n\t\t\t\t\t// lib目录放行\r\n\t\t\t\t\tpopRegx : ['^intl-style/trunk/deploy/htdocs/js/5v/lib/*','^intl-style/branches/.*?/deploy/htdocs/js/5v/lib/*']\r\n\t\t\t\t},\r\n\t\t\t\tvalidateRule : '^(.*?)\\\\.(?:js|md|js.seed|xml|html|spec.js).*$'\r\n\t\t\t},\r\n\t\t\t// CSS目录文件规则\r\n\t\t\t'CssDirRules' : {\r\n\t\t\t\truleName : 'The Css Dir Validate Rules',\r\n\t\t\t\twarnning : '(!) New css file rule is : extname must be [css|md|css.seed|html].',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'file',\r\n\t\t\t\t\tcommitType : ['A'],\r\n\t\t\t\t\tinRegx : ['^intl-style/trunk/deploy/htdocs/css/*','^intl-style/branches/.*?/deploy/htdocs/css/*']\r\n\t\t\t\t},\r\n\t\t\t\tvalidateRule : '^(.*?)\\\\.(?:css|md|css.seed|html).*$'\r\n\t\t\t},\r\n\t\t\t// 图片目录文件规则\r\n\t\t\t'ImgDirRules' : {\r\n\t\t\t\truleName : 'The Images Dir Validate Rules',\r\n\t\t\t\twarnning : '(!) New image file rule is : extname must be [jpg|cur|gif|png|psd|md].',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'file',\r\n\t\t\t\t\tcommitType : ['A'],\r\n\t\t\t\t\tinRegx : ['^intl-style/trunk/deploy/htdocs/simg/*','^intl-style/trunk/deploy/htdocs/wimg/*','^intl-style/branches/.*?/deploy/htdocs/simg/*','^intl-style/branches/.*?/deploy/htdocs/wimg/*']\r\n\t\t\t\t},\r\n\t\t\t\tvalidateRule : '^(.*?)\\\\.(?:jpg|cur|gif|png|psd|md).*$'\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 编码检测规则\r\n\t\t'mod-validator-charset' : {\r\n\t\t\t// style utf-8 rule\r\n\t\t\t'TheUTF8NoBOMRules' : {\r\n\t\t\t\truleName : 'Files Charset Validate Rules',\r\n\t\t\t\twarnning : '(!) File(s) with wrong charset. there must be : ASCII, UTF-8(without BOM).',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'file'\r\n\t\t\t\t},\r\n\t\t\t\tvalidateRule : ['utf-8','ascii','null','windows-1252']\r\n\t\t\t}\r\n\t\t},\r\n\t\t// JS语法检测\r\n\t\t'mod-validator-jshint' : {\r\n\t\t\t'TheJsHintRules' : {\r\n\t\t\t\truleName : 'The Javascript Hint Rule',\r\n\t\t\t\twarnning : '(!) JsHint Warnning(s).',\r\n\t\t\t\tfilter : {\r\n\t\t\t\t\titemType : 'file',\r\n\t\t\t\t\tcommitType : ['A','U','_U','UU','G'],\r\n\t\t\t\t\textName : [\".js\"],\r\n\t\t\t\t\tinRegx : ['^intl-style/trunk/deploy/htdocs/js/*','^intl-style/branches/.*?/deploy/htdocs/js/*']\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\t// ↑ 各种检测模块配置\r\n\t\r\n};\r\n\r\n// 载入提交前检测模块\r\nvar preCommit = require('node.svntail/lib/hook-pre-commit.js');\r\n\r\n// 传入自定义配置 开始运行\r\npreCommit.start(config);\r\n~~~\r\n\r\n运行服务端(默认端口为99)\r\n--------------------\r\n~~~javascript\r\n// 开启前注意配置SVN钩子端的remoteConnect及remoteApiSettings配置\r\nnode node.svntail/lib/server-reporter.js\r\n~~~","tagline":"基于nodejs的svn hook相关扩展(pre-commit/post-commit) 拥有检测文件内容及过滤功能","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}